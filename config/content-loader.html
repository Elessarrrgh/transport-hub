// This loader should be placed in the SquareSpace site header in order to be universal to all pages.


<script>
async function loadShowContent() {
  try {
    // Parse URL: /{showAcronym}/{year}/{route}/...
    const pathParts = window.location.pathname.split("/").filter(Boolean);
    if (pathParts.length < 2) return;

    const showKey = pathParts[0]; // e.g., "ABC"
    const year = pathParts[1];    // e.g., "2025"
    const route = pathParts[2] || null; // optional route

    // Step 1: Fetch directory JSON
    const dirResponse = await fetch("https://elessarrrgh.github.io/transport-hub/shows.json?nocache=" + Date.now());
    const showDirectory = await dirResponse.json();
    const showJsonUrl = showDirectory[showKey];

    if (!showJsonUrl) {
      console.warn("No JSON found for show:", showKey);
      return;
    }

    // Step 2: Fetch individual show JSON
    const showResponse = await fetch(showJsonUrl + "?nocache=" + Date.now());
    const showData = await showResponse.json();

    // Step 3: Grab base and year-specific data
    const baseData = showData.base || {};
    const yearData = (showData.years && showData.years[year]) || {};

    // Optional: grab route-specific data
    const routeData = (yearData.routes && route && yearData.routes[route]) || {};

    // Step 4: Build HTML
    const html = `
      <h2>${baseData.title || "Event Title"}</h2>

      <div class="event-section">
        <h3>Venue Map</h3>
        ${baseData.mapUrl ? `<iframe src="${baseData.mapUrl}" width="100%" height="400" style="border:0;" loading="lazy"></iframe>` : `<p>Map unavailable.</p>`}
      </div>

      <div class="event-section">
        <h3>Event Flyer</h3>
        ${baseData.flyerUrl ? `<p><a href="${baseData.flyerUrl}" target="_blank" rel="noopener">Download Flyer (PDF)</a></p>` : `<p>Flyer unavailable.</p>`}
      </div>

      ${routeData.hotels && routeData.hotels.length > 0 ? `
        <div class="event-section">
          <h3>Hotels for ${route}</h3>
          <ul>
            ${routeData.hotels.map(hotel => `
              <li>
                <a href="${hotel.url}" target="_blank">${hotel.name}</a>
                ${hotel.imageUrl ? `<img src="${hotel.imageUrl}" alt="${hotel.name}" style="width:100px;height:auto;">` : ""}
              </li>
            `).join("")}
          </ul>
        </div>
      ` : route ? `<p>No hotels listed for ${route}.</p>` : ""}

      ${baseData.notes ? `<div class="event-notes"><em>${baseData.notes}</em></div>` : ""}
    `;

    // Step 5: Inject into placeholder
    const container = document.querySelector("[data-event]");
    if (container) container.innerHTML = html;

  } catch (err) {
    console.error("Error loading show content:", err);
  }
}

// Run after page is ready
document.addEventListener("DOMContentLoaded", loadShowContent);
</script>
